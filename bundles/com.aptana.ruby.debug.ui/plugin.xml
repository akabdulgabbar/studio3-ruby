<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<plugin>
	<!-- Adapters for contextual launch -->
	<extension point="org.eclipse.core.runtime.adapters">
         <factory 
            class="" 
            adaptableType="org.eclipse.core.resources.IResource">
            <adapter type="org.eclipse.debug.ui.actions.ILaunchable"/>
         </factory>
      <factory
            class="com.aptana.ruby.debug.ui.RubyBreakpointAdapterFactory"
            adaptableType="org.eclipse.ui.texteditor.ITextEditor">
         <adapter
               type="org.eclipse.debug.ui.actions.IToggleBreakpointsTarget">
         </adapter>
      </factory>
      <factory
            adaptableType="com.aptana.editor.erb.html.RHTMLEditor"
             class="com.aptana.ruby.debug.ui.RubyBreakpointAdapterFactory">
         <adapter
               type="org.eclipse.debug.ui.actions.IToggleBreakpointsTarget">
         </adapter>
      </factory>
   </extension>
	<extension point="org.eclipse.debug.ui.launchShortcuts">
		<shortcut label="%RubyApplicationShortcut.label"
			icon="icons/full/ctool16/run_ruby.gif"
			class="com.aptana.ruby.debug.ui.launcher.RubyApplicationShortcut"
			modes="run, debug" id="com.aptana.ruby.debug.ui.RubyShortcut">
			<contextualLaunch>
				<enablement>
					<with variable="selection">
						<count value="1">
						</count>
						<iterate>
       <and>
          <adapt
                type="org.eclipse.core.resources.IFile">
          </adapt>
          <or>
             <test
                   property="org.eclipse.debug.ui.matchesPattern"
                   value="*.rb">
             </test>
             <test
                   property="org.eclipse.debug.ui.matchesPattern"
                   value="*.rbx">
             </test>
             <test
                   property="org.eclipse.debug.ui.matchesPattern"
                   value="*.rbw">
             </test>
             <test
                   args="kindOf"
                   property="org.eclipse.core.resources.contentTypeId"
                   value="com.aptana.contenttype.ruby">
             </test>
          </or>
       </and>
						</iterate>
					</with>
				</enablement>
				<contextLabel label="%LaunchShortcut.Ruby.label" mode="run">
				</contextLabel>
				<contextLabel label="%LaunchShortcut.Ruby.label" mode="debug">
				</contextLabel>
			</contextualLaunch>
		</shortcut>
	</extension>
	<extension point="org.eclipse.ui.commands">
		<command name="%ContextualRunRubyApplication.label"
			description="%ContextualRunRubyApplication.label"
			categoryId="org.eclipse.debug.ui.category.run"
			id="com.aptana.ruby.debug.ui.RubyShortcut.run">
		</command>
		<command name="%ContextualDebugRubyApplication.label"
			description="%ContextualDebugRubyApplication.label"
			categoryId="org.eclipse.debug.ui.category.run"
			id="com.aptana.ruby.debug.ui.RubyShortcut.debug">
		</command>
	</extension>
	<extension point="org.eclipse.ui.bindings">
		<key sequence="M3+M2+D R"
			commandId="com.aptana.ruby.debug.ui.RubyShortcut.debug"
			schemeId="org.eclipse.ui.defaultAcceleratorConfiguration"/>
		<key sequence="M3+M2+X R"
			commandId="com.aptana.ruby.debug.ui.RubyShortcut.run"
			schemeId="org.eclipse.ui.defaultAcceleratorConfiguration"/>
	</extension>
	<extension point="org.eclipse.ui.popupMenus">
		<viewerContribution
           id="com.aptana.ruby.debug.ui.RulerPopupActions"
           targetID="com.aptana.editor.ruby.RulerContext">
         <action
               label="%AddBreakpoint.label"
               class="org.eclipse.debug.ui.actions.RulerToggleBreakpointActionDelegate"
               menubarPath="debug"
               id="com.aptana.ruby.debug.ui.actions.ToggleBreakpointAction">
         </action>
      </viewerContribution>
		<viewerContribution
           id="com.aptana.ruby.debug.ui.RulerPopupActions"
           targetID="com.aptana.editor.erb.html.RulerContext">
         <action
               label="%AddBreakpoint.label"
               class="org.eclipse.debug.ui.actions.RulerToggleBreakpointActionDelegate"
               menubarPath="debug"
               id="com.aptana.ruby.debug.ui.actions.ToggleBreakpointAction">
         </action>
      </viewerContribution>
	</extension>
	  <extension
         point="org.eclipse.debug.ui.debugModelPresentations">
      <debugModelPresentation
            class="com.aptana.ruby.debug.ui.RubyModelPresentation"
            id="com.aptana.ruby.debug">
      </debugModelPresentation>
   </extension>
   <extension
         point="org.eclipse.debug.ui.launchConfigurationTabGroups">
      <launchConfigurationTabGroup
            type="com.aptana.ruby.debug.core.launchConfigurationType"
            description="%launchConfigurationTabGroup.ruby.description"
            class="com.aptana.ruby.debug.ui.launcher.RubyTabGroup"
            id="com.aptana.ruby.debug.ui.launchConfigurationTabGroup.ruby">
      </launchConfigurationTabGroup>      
      <launchConfigurationTabGroup
        class="com.aptana.ruby.debug.ui.launcher.RemoteRubyApplicationTabGroup"
        description="%remoteRubyApplicationTabGroupDescription"
        id="com.aptana.ruby.debug.ui.launchConfigurationTabGroup.remoteRubyApplication"
        type="com.aptana.ruby.debug.core.remoteDebuggerLaunchConfigurationType">
  	  </launchConfigurationTabGroup>
   </extension>
   <extension point="org.eclipse.ui.views">
      <view
            name="%displayViewName"
            icon="$nl$/icons/full/etool16/disp_sbook.gif"
            category="org.eclipse.debug.ui"
            class="com.aptana.ruby.internal.debug.ui.display.DisplayView"
            id="com.aptana.ruby.debug.ui.DisplayView">
      </view>
    </extension>
   <extension
         point="org.eclipse.ui.perspectiveExtensions">
      <perspectiveExtension
            targetID="com.aptana.ui.WebPerspective">
         <perspectiveShortcut
               id="org.eclipse.debug.ui.DebugPerspective">
         </perspectiveShortcut>
      </perspectiveExtension>
      <perspectiveExtension
            targetID="org.eclipse.debug.ui.DebugPerspective">
         <perspectiveShortcut
               id="com.aptana.ui.WebPerspective">
         </perspectiveShortcut>
       <view
             id="com.aptana.ruby.debug.ui.DisplayView"
             relationship="stack"
             relative="org.eclipse.ui.console.ConsoleView"
             visible="false"/>
       <viewShortcut id="com.aptana.ruby.debug.ui.DisplayView"/>
      </perspectiveExtension>
   </extension>   
   <extension
         point="org.eclipse.ui.contexts">
      <context
            name="%context.debug.name"
            description="%context.debug.description"
            id="com.aptana.ruby.debug.ui.debugging"
            parentId="org.eclipse.debug.ui.debugging">
      </context>
   </extension>
   <extension
         point="org.eclipse.debug.ui.debugModelContextBindings">
      <modelContextBinding
            debugModelId="com.aptana.ruby.debug"
            contextId="com.aptana.ruby.debug.ui.debugging">
      </modelContextBinding>
   </extension>
   <extension
         point="org.eclipse.debug.ui.launchConfigurationTypeImages">
      <launchConfigurationTypeImage
            icon="icons/full/ctool16/run_ruby.gif"
            configTypeID="com.aptana.ruby.debug.core.launchConfigurationType"
            id="com.aptana.ruby.debug.ui.ruby.launchConfigurationTypeImage">
      </launchConfigurationTypeImage>
   </extension>   
    <extension point="org.eclipse.ui.editorActions">
     <editorContribution
           id="com.aptana.ruby.debug.RubyEditor.BreakpointRulerActions"
          targetID="com.aptana.editor.ruby">
        <action
              label="%action.notused.label"
              class="org.eclipse.debug.ui.actions.RulerToggleBreakpointActionDelegate"
              style="push"
              actionID="RulerDoubleClick"
              id="com.aptana.ruby.debug.ui.doubleClickBreakpointAction"/>
     </editorContribution>
  </extension>
  
  <extension point="org.eclipse.ui.commands">
    <command
        categoryId="org.eclipse.debug.ui.category.run"
        id="com.aptana.ruby.debug.ui.commands.ModifyCatchpoint"
        name="%modifyCatchpoint.label"/>
    <command
          defaultHandler="com.aptana.ruby.internal.debug.ui.display.ExecuteHandler"
          id="com.aptana.ruby.debug.ui.commands.execute"
          name="%execute.command.name">
    </command>
    <command
          defaultHandler="com.aptana.ruby.internal.debug.ui.display.ClearDisplayViewHandler"
          id="com.aptana.ruby.debug.ui.command.clear_display"
          name="%clear_display.command.name">
    </command>
  </extension>
  <extension point="org.eclipse.ui.actionSets">
    <actionSet
        description="%rubyDebugActionSet.description"
        id="com.aptana.ruby.debug.ui.RubyDebugActionSet"
        label="%rubyDebugSctionSet.label"
        visible="true">
      <action
        definitionId="com.aptana.ruby.debug.ui.commands.ModifyCatchpoint"
        label="%modifyCatchpoint.label"
        icon="icons/full/elcl16/exc_catch.gif"
        helpContextId="add_exception_action_context"
        class="com.aptana.ruby.internal.debug.ui.breakpoints.AddExceptionAction"
        menubarPath="org.eclipse.ui.run/breakpointGroup"
        id="com.aptana.ruby.debug.ui.actions.ModifyCatchpoint">
      </action>
    </actionSet>
  </extension>
  <extension point="org.eclipse.ui.viewActions">
    <!-- Show statics/constants
    <viewContribution targetID="org.eclipse.debug.ui.VariableView"
      id="org.rubypeople.rdt.ui.debug.VariableViewActions">
      <action label="%showStaticVariables" style="toggle"
        class="org.rubypeople.rdt.internal.debug.ui.actions.ShowStaticVariablesAction"
        state="false" tooltip="%action.tooltip.0"
        menubarPath="rubyActions"
        id="org.rubypeople.rdt.ui.variableViewActions.ShowStatic">
      </action>
      <action label="%showConstants" style="toggle"
        class="org.rubypeople.rdt.internal.debug.ui.actions.ShowConstantsAction"
        state="false" tooltip="%action.tooltip.1"
        menubarPath="rubyActions"
        id="org.rubypeople.rdt.ui.variableViewActions.ShowConstants">
      </action>
    </viewContribution>
    -->
    <viewContribution
        id="com.aptana.ruby.debug.ui.BreakpointViewActions"
        targetID="org.eclipse.debug.ui.BreakpointView">
     <action
           class="com.aptana.ruby.internal.debug.ui.breakpoints.AddExceptionAction"
           disabledIcon="icons/full/elcl16/exc_catch.gif"
           helpContextId="add_exception_action_context"
           hoverIcon="icons/full/elcl16/exc_catch.gif"
           icon="icons/full/elcl16/exc_catch.gif"
           id="com.aptana.ruby.debug.ui.actions.AddException"
           label="%modifyCatchpoint.label"
           style="push"
           toolbarPath="rubyExceptions"
           tooltip="%modifyCatchpoint.tooltip"/>
    </viewContribution>
  </extension>
  <extension
        point="org.eclipse.debug.ui.detailPaneFactories">
     <detailFactories
           class="com.aptana.ruby.internal.debug.ui.breakpoints.BreakpointDetailPaneFactory"
           id="com.aptana.ruby.debug.ui.breakpoint.detailFactories">
        <enablement>
           <with
                 variable="selection">
              <count
                    value="1">
              </count>
              <iterate>
                 <or>
                    <instanceof
                          value="com.aptana.ruby.debug.core.IRubyLineBreakpoint">
                    </instanceof>
                    <instanceof
                          value="com.aptana.ruby.debug.core.model.IRubyExceptionBreakpoint">
                    </instanceof>
                 </or>
              </iterate>
           </with>
        </enablement>
     </detailFactories>
  </extension>
  <extension
        point="org.eclipse.ui.elementFactories">
     <factory
           class="com.aptana.ruby.internal.debug.ui.StorageEditorInputFactory"
           id="com.aptana.ui.part.StorageEditorInputFactory">
     </factory>
  </extension>
  <extension
        point="org.eclipse.core.filebuffers.annotationModelCreation">
     <factory
           class="com.aptana.ruby.debug.ui.ExternalRubyFileAnnotationModelFactory"
           contentTypeId="com.aptana.contenttype.ruby">
     </factory>
  </extension>
  <extension
        point="org.eclipse.ui.menus">
     <menuContribution
           allPopups="false"
           locationURI="toolbar:com.aptana.ruby.debug.ui.DisplayView">
        <command
              commandId="com.aptana.ruby.debug.ui.commands.execute"
              icon="icons/full/etool16/run_sbook.gif"
              style="push">
        </command>
        <command
              commandId="com.aptana.ruby.debug.ui.command.clear_display"
              icon="platform:/plugin/org.eclipse.ui.console/icons/full/elcl16/clear_co.gif"
              style="push">
        </command>
     </menuContribution>
  </extension>
  <extension
        point="org.eclipse.debug.ui.contextViewBindings">
     <contextViewBinding
           autoOpen="true"
           contextId="com.aptana.ruby.debug.ui.debugging"
           viewId="org.eclipse.debug.ui.DebugView">
     </contextViewBinding>
     <contextViewBinding
           autoOpen="true"
           contextId="com.aptana.ruby.debug.ui.debugging"
           viewId="org.eclipse.debug.ui.VariableView">
     </contextViewBinding>
     <contextViewBinding
           autoOpen="true"
           contextId="com.aptana.ruby.debug.ui.debugging"
           viewId="org.eclipse.debug.ui.ExpressionView">
     </contextViewBinding>
  </extension>
  <extension
        point="com.aptana.editor.common.textHovers">
     <hover
           class="com.aptana.ruby.internal.debug.ui.RubyDebugHover"
           id="com.aptana.ruby.debug.ui.hover"
           label="%hover.label">
        <contentType
              type="com.aptana.contenttype.ruby">
        </contentType>
        <enablement>
          <systemTest
                property="com.aptana.ruby.debug.ui.debuggerActive"
                value="true">
          </systemTest>
        </enablement>
     </hover>
  </extension>
</plugin>
